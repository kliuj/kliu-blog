!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}({0:function(e,t,r){e.exports=r(13)},13:function(e,t){function r(){var e;e="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com",this.detectIEVersion=function(){for(var e=4,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+e+"]><i></i><![endif]-->",r[0];)e++;return e>4?e:!1},this.isImage=function(e){var t,r="",n=["png","jpg","jpeg","gif","bmp"],i=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!e||!i.test(e))return!1;t=i.exec(e),r=t[1].toLowerCase();for(var a=0,o=n.length;o>a;a++)if(r===n[a])return!0;return!1},this.getFileExtension=function(e){var t,r=e.split(".");return t=1===r.length||""===r[0]&&2===r.length?"":r.pop().toLowerCase()},this.utf8_encode=function(e){if(null===e||"undefined"==typeof e)return"";var t,r,n=e+"",i="",a=0;t=r=0,a=n.length;for(var o=0;a>o;o++){var s=n.charCodeAt(o),u=null;if(128>s)r++;else if(s>127&&2048>s)u=String.fromCharCode(s>>6|192,63&s|128);else if(63488&s^!0)u=String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128);else{if(64512&s^!0)throw new RangeError("Unmatched trail surrogate at "+o);var f=n.charCodeAt(++o);if(64512&f^!0)throw new RangeError("Unmatched lead surrogate at "+(o-1));s=((1023&s)<<10)+(1023&f)+65536,u=String.fromCharCode(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}null!==u&&(r>t&&(i+=n.slice(t,r)),i+=u,t=r=o+1)}return r>t&&(i+=n.slice(t,a)),i},this.base64_encode=function(e){var t,r,n,i,a,o,s,u,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,l=0,p="",d=[];if(!e)return e;e=this.utf8_encode(e+"");do t=e.charCodeAt(c++),r=e.charCodeAt(c++),n=e.charCodeAt(c++),u=t<<16|r<<8|n,i=u>>18&63,a=u>>12&63,o=u>>6&63,s=63&u,d[l++]=f.charAt(i)+f.charAt(a)+f.charAt(o)+f.charAt(s);while(c<e.length);switch(p=d.join(""),e.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p},this.URLSafeBase64Encode=function(e){return e=this.base64_encode(e),e.replace(/\//g,"_").replace(/\+/g,"-")},this.createAjax=function(e){var t={};return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(e){return window.JSON&&window.JSON.parse?window.JSON.parse(e):null===e?e:"string"==typeof e&&(e=this.trim(e),e&&/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))?function(){return e}():void 0},this.trim=function(e){return null===e?"":e.replace(/^\s+|\s+$/g,"")};var t=this;this.uploader=function(r){if(!r.domain)throw"uptoken_url or domain is required!";if(!r.browse_button)throw"browse_button is required!";var n={},i=r.init&&r.init.Error,a=r.init&&r.init.FileUploaded;r.init.Error=function(){},r.init.FileUploaded=function(){},t.uptoken_url=r.uptoken_url,t.token="",t.key_handler="function"==typeof r.init.Key?r.init.Key:"",this.domain=r.domain;var o="",s={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""},u=function(){var e,n,i,a=t.detectIEVersion(),o="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;a&&9>=a&&r.chunk_size&&r.runtimes.indexOf("flash")>=0?r.chunk_size=0:o?r.chunk_size=0:(e=20,n=4<<e,i=plupload.parseSize(r.chunk_size),i>n&&(r.chunk_size=n))};u();var f=function(){if(r.uptoken)t.token=r.uptoken;else{var e=t.createAjax();e.open("GET",t.uptoken_url,!0),e.setRequestHeader("If-Modified-Since","0"),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var r=t.parseJSON(e.responseText);t.token=r.uptoken}},e.send()}},c=function(e,n,i){var a="",o=!1;if(!r.save_key)if(o=e.getOption&&e.getOption("unique_names"),o=o||e.settings&&e.settings.unique_names){var s=t.getFileExtension(n.name);a=s?n.id+"."+s:n.id}else a="function"==typeof i?i(e,n):n.name;return a};plupload.extend(n,r,{url:e,multipart_params:{token:""}});var l=new plupload.Uploader(n);return l.bind("Init",function(e,t){f()}),l.init(),l.bind("FilesAdded",function(e,t){var r=e.getOption&&e.getOption("auto_start");r=r||e.settings&&e.settings.auto_start,r&&plupload.each(t,function(t,r){e.start()}),e.refresh()}),l.bind("BeforeUpload",function(n,i){i.speed=i.speed||0,o="",r.get_new_uptoken&&f();var a=function(n,i,a){s.startTime=(new Date).getTime();var o;o=r.save_key?{token:t.token}:{key:c(n,i,a),token:t.token};var u=r.x_vars;if(void 0!==u&&"object"==typeof u)for(var f in u)u.hasOwnProperty(f)&&("function"==typeof u[f]?o["x:"+f]=u[f](n,i):"object"!=typeof u[f]&&(o["x:"+f]=u[f]));n.setOption({url:e,multipart:!0,chunk_size:void 0,multipart_params:o})},u=n.getOption&&n.getOption("chunk_size");if(u=u||n.settings&&n.settings.chunk_size,"html5"===l.runtime&&u)if(i.size<u)a(n,i,t.key_handler);else{var p=localStorage.getItem(i.name),d=u;if(p){p=JSON.parse(p);var h=(new Date).getTime(),m=p.time||0,g=864e5;g>h-m&&100!==p.percent&&i.size===p.total?(i.percent=p.percent,i.loaded=p.offset,o=p.ctx,s.isResumeUpload=!0,s.resumeFilesize=p.offset,p.offset+d>i.size&&(d=i.size-p.offset)):localStorage.removeItem(i.name)}s.startTime=(new Date).getTime(),n.setOption({url:e+"/mkblk/"+d,multipart:!1,chunk_size:u,required_features:"chunks",headers:{Authorization:"UpToken "+t.token},multipart_params:{}})}else a(n,i,t.key_handler)}),l.bind("UploadProgress",function(e,t){s.currentTime=(new Date).getTime();var r=s.currentTime-s.startTime,n=t.loaded||0;s.isResumeUpload&&(n=t.loaded-s.resumeFilesize),t.speed=(n/r*1e3).toFixed(0)||0}),l.bind("ChunkUploaded",function(r,n,i){var a=t.parseJSON(i.response);o=o?o+","+a.ctx:a.ctx;var s=i.total-i.offset,u=r.getOption&&r.getOption("chunk_size");u=u||r.settings&&r.settings.chunk_size,u>s&&r.setOption({url:e+"/mkblk/"+s}),localStorage.setItem(n.name,JSON.stringify({ctx:o,percent:n.percent,total:i.total,offset:i.offset,time:(new Date).getTime()}))}),l.bind("Error",function(e){return function(r,n){var i="",a=n.file;if(a){switch(n.code){case plupload.FAILED:i="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var o=r.getOption&&r.getOption("max_file_size");o=o||r.settings&&r.settings.max_file_size,i="浏览器最大可上传"+o+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:i="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===n.response){i=n.message||"未知网络错误。";break}var s=t.parseJSON(n.response),u=s.error;switch(n.status){case 400:i="请求报文格式错误。";break;case 401:i="客户端认证授权失败。请重试或提交反馈。";break;case 405:i="客户端请求错误。请重试或提交反馈。";break;case 579:i="资源上传成功，但回调失败。";break;case 599:i="网络连接异常。请重试或提交反馈。";break;case 614:i="文件已存在。";try{s=t.parseJSON(s.error),u=s.error||"file exists"}catch(f){u=s.error||"file exists"}break;case 631:i="指定空间不存在。";break;case 701:i="上传数据块校验出错。请重试或提交反馈。";break;default:i="未知错误。"}i=i+"("+n.status+"："+u+")";break;case plupload.SECURITY_ERROR:i="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:i="上传失败。请稍后再试。";break;case plupload.IO_ERROR:i="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:i="网站配置错误。请联系网站管理员。",l.destroy();break;default:i=n.message+n.details}e&&e(r,n,i)}r.refresh()}}(i)),l.bind("FileUploaded",function(n){return function(i,a,s){var u=function(e,i,a){if(r.downtoken_url){var o=t.createAjax();o.open("POST",r.downtoken_url,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var r;try{r=t.parseJSON(o.responseText)}catch(s){throw"invalid json format"}var u={};plupload.extend(u,t.parseJSON(a),r),n&&n(e,i,JSON.stringify(u))}else l.trigger("Error",{status:o.status,response:o.responseText,file:i,code:plupload.HTTP_ERROR})},o.send("key="+t.parseJSON(a).key+"&domain="+r.domain)}else n&&n(e,i,a)},f=t.parseJSON(s.response);if(o=o?o:f.ctx){var p="";r.save_key||(p=c(i,a,t.key_handler),p=p?"/key/"+t.URLSafeBase64Encode(p):"");var d="/fname/"+t.URLSafeBase64Encode(a.name),h=r.x_vars,m="",g="";if(void 0!==h&&"object"==typeof h)for(var v in h)h.hasOwnProperty(v)&&("function"==typeof h[v]?m=t.URLSafeBase64Encode(h[v](i,a)):"object"!=typeof h[v]&&(m=t.URLSafeBase64Encode(h[v])),g+="/x:"+v+"/"+m);var k=e+"/mkfile/"+a.size+p+d+g,x=t.createAjax();x.open("POST",k,!0),x.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),x.setRequestHeader("Authorization","UpToken "+t.token),x.onreadystatechange=function(){if(4===x.readyState)if(localStorage.removeItem(a.name),200===x.status){var e=x.responseText;u(i,a,e)}else l.trigger("Error",{status:x.status,response:x.responseText,file:a,code:-200})},x.send(o)}else u(i,a,s.response)}}(a)),l},this.getUrl=function(e){if(!e)return!1;e=encodeURI(e);var t=this.domain;return"/"!==t.slice(t.length-1)&&(t+="/"),t+e},this.imageView2=function(e,t){var r=e.mode||"",n=e.w||"",i=e.h||"",a=e.q||"",o=e.format||"";if(!r)return!1;if(!n&&!i)return!1;var s="imageView2/"+r;return s+=n?"/w/"+n:"",s+=i?"/h/"+i:"",s+=a?"/q/"+a:"",s+=o?"/format/"+o:"",t&&(s=this.getUrl(t)+"?"+s),s},this.imageMogr2=function(e,t){var r=e["auto-orient"]||"",n=e.thumbnail||"",i=e.strip||"",a=e.gravity||"",o=e.crop||"",s=e.quality||"",u=e.rotate||"",f=e.format||"",c=e.blur||"",l="imageMogr2";return l+=r?"/auto-orient":"",l+=n?"/thumbnail/"+n:"",l+=i?"/strip":"",l+=a?"/gravity/"+a:"",l+=s?"/quality/"+s:"",l+=o?"/crop/"+o:"",l+=u?"/rotate/"+u:"",l+=f?"/format/"+f:"",l+=c?"/blur/"+c:"",t&&(l=this.getUrl(t)+"?"+l),l},this.watermark=function(e,t){var r=e.mode;if(!r)return!1;var n="watermark/"+r;if(1===r){var i=e.image||"";if(!i)return!1;n+=i?"/image/"+this.URLSafeBase64Encode(i):""}else{if(2!==r)return!1;var a=e.text?e.text:"",o=e.font?e.font:"",s=e.fontsize?e.fontsize:"",u=e.fill?e.fill:"";if(!a)return!1;n+=a?"/text/"+this.URLSafeBase64Encode(a):"",n+=o?"/font/"+this.URLSafeBase64Encode(o):"",n+=s?"/fontsize/"+s:"",n+=u?"/fill/"+this.URLSafeBase64Encode(u):""}var f=e.dissolve||"",c=e.gravity||"",l=e.dx||"",p=e.dy||"";return n+=f?"/dissolve/"+f:"",n+=c?"/gravity/"+c:"",n+=l?"/dx/"+l:"",n+=p?"/dy/"+p:"",t&&(n=this.getUrl(t)+"?"+n),n},this.imageInfo=function(e){if(!e)return!1;var t,r=this.getUrl(e)+"?imageInfo",n=this.createAjax(),i=this;return n.open("GET",r,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(t=i.parseJSON(n.responseText))},n.send(),t},this.exif=function(e){if(!e)return!1;var t,r=this.getUrl(e)+"?exif",n=this.createAjax(),i=this;return n.open("GET",r,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(t=i.parseJSON(n.responseText))},n.send(),t},this.get=function(e,t){return t&&e?"exif"===e?this.exif(t):"imageInfo"===e?this.imageInfo(t):!1:!1},this.pipeline=function(e,t){var r,n,i="[object Array]"===Object.prototype.toString.call(e),a="";if(i){for(var o=0,s=e.length;s>o;o++){if(r=e[o],!r.fop)return!1;switch(r.fop){case"watermark":a+=this.watermark(r)+"|";break;case"imageView2":a+=this.imageView2(r)+"|";break;case"imageMogr2":a+=this.imageMogr2(r)+"|";break;default:n=!0}if(n)return!1}if(t){a=this.getUrl(t)+"?"+a;var u=a.length;"|"===a.slice(u-1)&&(a=a.slice(0,u-1))}return a}return!1}}new r}});